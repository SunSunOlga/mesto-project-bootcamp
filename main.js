(()=>{"use strict";var e=document.querySelector(".elements-grid");function t(t){e.prepend(t)}var n={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-7",headers:{authorization:"5c0ea949-1e0d-409c-aab2-ad8dda3585dc","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var o=document.querySelector(".item-template").content.querySelector(".element");function c(e,t){document.querySelector(".element");var c=o.cloneNode(!0),a=c.querySelector(".element__caption"),l=c.querySelector(".element__picture"),i=c.querySelector(".js-like-element"),u=c.querySelector(".js-delete-element"),s=c.querySelector(".element__number-like");function d(e){return e.includes(t)}return a.textContent=e.name,l.src=e.link,l.alt=e.name,l.id=e.cardId,s.textContent=e.likes.length,t===e.owner._id?u.addEventListener("click",(function(e){var t,o,c=e.target.closest(".element").querySelector(".element__picture").id;(o=c,fetch("".concat(n.baseUrl,"/cards/").concat(o),{headers:n.headers,method:"DELETE"}).then(r)).then((t=e,void t.target.closest(".element").remove())).catch(console.dir)})):u.remove(),i.likes=e.likes.map((function(e){return e._id})),d(i.likes)&&i.classList.toggle("element__button-like_active"),i.addEventListener("click",(function(t){function o(e){t.target.likes=e.likes.map((function(e){return e._id})),t.target.classList.toggle("element__button-like_active"),s.textContent=t.target.likes.length}var c;d(t.target.likes)?(c=e._id,fetch("".concat(n.baseUrl,"/cards/likes/").concat(c),{headers:n.headers,method:"DELETE"}).then(r)).then(o).catch((function(e){console.log(e)})):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{headers:n.headers,method:"PUT"}).then(r)}(e._id).then(o).catch((function(e){console.log(e)}))})),l.addEventListener("click",(function(e){var t,n,r;n=(t={name:e.target.alt,link:e.target.src}).name,r=t.link,T.textContent=n,x.src=r,x.alt=n,y(C)})),c}var a=document.querySelector(".js-name-profile"),l=document.querySelector(".js-job-profile"),i=document.querySelector(".profile__image");function u(e){var t=e.name,n=e.about;a.textContent=t,l.textContent=n}function s(e){var t=e.avatar;i.src=t}var d=document.querySelector(".js-edit-profile"),f=document.querySelector(".popup-profile"),m=document.querySelector(".popup-profile"),p=f.querySelector(".js-form-profile"),v=p.querySelector(".js-input-name"),h=p.querySelector(".js-input-job");function y(e){e.classList.add("popup_opened"),document.addEventListener("keydown",S),e.addEventListener("click",b)}function S(e){"Escape"===e.key&&_(document.querySelector(".popup_opened"))}function b(e){e.currentTarget===e.target&&_(e.currentTarget)}function _(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",S),e.removeEventListener("click",b)}document.querySelectorAll(".popup__button-close").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return _(t)}))}));var q=document.querySelector(".popup-cards"),k=q.querySelector(".js-form-cards"),g=document.querySelector(".js-form-cards"),E=g.querySelector(".js-input-text-card"),j=g.querySelector(".js-input-link-card"),L=g.querySelector(".js-save-card");g.addEventListener("submit",(function(e){var o;e.preventDefault(),(o={name:E.value,link:j.value},fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers,method:"POST",body:JSON.stringify(o)}).then(r)).then((function(e,n){t(c(e,n)),_(q),g.reset()})).catch((function(e){console.log(e)}))}));var C=document.querySelector(".popup-photos"),x=C.querySelector(".popup__photo"),T=C.querySelector(".popup__figaption");document.querySelector(".profile__button-add").addEventListener("click",(function(){k.checkValidity()?L.disabled=!1:L.disabled=!0,y(q)})),d.addEventListener("click",(function(){p.checkValidity()?L.disabled=!1:L.disabled=!0;var e={name:a.textContent,about:l.textContent},t=e.name,n=e.about;v.value=t,h.value=n,y(m)}));var A=p.querySelector(".js-save-form");function U(e,t){e.textContent=t}p.addEventListener("submit",(function(e){var t;e.preventDefault(),U(A,"Сохранение..."),(t={name:v.value,about:h.value},fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers,method:"PATCH",body:JSON.stringify(t)}).then(r)).then((function(e){u(e),_(f)})).catch((function(e){console.log(e)})).finally((function(){U(A,"Сохранить")}))}));var w,O=document.querySelector(".popup-avatar"),P=O.querySelector(".js-form-avatar"),D=P.querySelector(".js-input-link-avatar"),I=document.querySelector(".profile__button-avatar"),N=P.querySelector(".js-save-avatar");function V(e,t){e.checkValidity()?t.disabled=!1:t.disabled=!0}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}I.addEventListener("click",(function(){P.checkValidity()?L.disabled=!1:L.disabled=!0,y(O)})),P.addEventListener("submit",(function(e){var t;e.preventDefault(),U(N,"Сохранение..."),(t={avatar:D.value},fetch("".concat(n.baseUrl,"/users/me/avatar"),{headers:n.headers,method:"PATCH",body:JSON.stringify(t)}).then(r)).then((function(e){s(e),_(O)})).catch((function(e){console.log(e)})).finally((function(){U(N,"Сохранить")}))})),Promise.all([fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers,method:"GET"}).then(r),fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers,method:"GET"}).then(r)]).then((function(e){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,l=[],i=!0,u=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(l.push(r.value),l.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return l}}(n,r)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],l=o[1];l._id,w=l._id,u(l),s(l),a.reverse().forEach((function(e){t(c(e,w))}))})).catch((function(e){console.log(e)})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){!function(e,t){var n=e.querySelectorAll(t.inputFieldSelector),r=e.querySelector(t.buttonSubmitSelector);V(e,r),n.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){e.querySelector("#error-"+t.id).textContent="",t.classList.remove(n.inputErrorClass)}(e,t,n):function(e,t,n,r){e.querySelector("#error-"+t.id).textContent=n,t.classList.add(r.inputErrorClass)}(e,t,t.validationMessage,n)}(e,n,t),V(e,r)}))}))}(t,e)}))}({formSelector:".form",inputFieldSelector:".form__field",buttonSubmitSelector:".form__button-save",inputErrorClass:"form__field_active"})})();
//# sourceMappingURL=main.js.map